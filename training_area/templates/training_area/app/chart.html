{% extends 'navbar.html' %}

<script>
{% block jquery %}
var endpoint = 'api/chartdata'
var defaultData = []
var labels = []
var canvas = document.getElementById('myChart');
var data = {
    labels: [],
    datasets: [
        {
            label: "My First dataset",
            fill: false,
            lineTension: 0.1,
            backgroundColor: "rgba(75,192,192,0.4)",
            borderColor: "rgba(75,192,192,1)",
            borderCapStyle: 'butt',
            borderDash: [],
            borderDashOffset: 0.0,
            borderJoinStyle: 'miter',
            pointBorderColor: "rgba(75,192,192,1)",
            pointBackgroundColor: "#fff",
            pointBorderWidth: 1,
            pointHoverRadius: 5,
            pointHoverBackgroundColor: "rgba(75,192,192,1)",
            pointHoverBorderColor: "rgba(220,220,220,1)",
            pointHoverBorderWidth: 2,
            pointRadius: 5,
            pointHitRadius: 10,
            data: [],
        }
    ]
};
var option = {
	showLines: true,
	 scales: {
            yAxes: [{
                ticks: {
                    beginAtZero:true,
                    fontColor: 'white'
                },
            }],
          xAxes: [{
                ticks: {
                	beginAtZero:true,
                    fontColor: 'white'
                },
            }]
        } 

};
var myLineChart = Chart.Line(canvas,{
	data:data,
	options:option

});


function setChart(){
	var ctx = document.getElementById('myChart');
		var myChart = new Chart(ctx, {
    		type: 'line',
    		data: {
        		labels: labels,
        		datasets: [{
            		label: '# votes',
            		data: defaultData,
				},{
					label: "title2",
        backgroundColor: "transparent",
        borderColor: "#fff",
        data: [50, 50, 50, 50, 50]
				}]
			}
		})
}

function setChart(){
	var ctx = document.getElementById('myChart');
		var myChart = new Chart(ctx, {
    		type: 'line',
    		data: {
        		labels: labels,
        		datasets: [{
            		label: '# votes',
            		data: defaultData,
				},{
					label: "title2",
        backgroundColor: "transparent",
        borderColor: "#fff",
        data: [50, 50, 50, 50, 50]
				}]
			}
		})
}

$("#id_athlete").change(function(){
	var athleteId = $(this).val();

	$.ajax({
		url: '/app/ajax/load-meso/',
		data:{
			'athlete': athleteId
		},
		success: function(data){
			console.log(data)
			$("#id_mesocycles").html(data);
		}
	});

});

$("#id_mesocycles").change(function(){
	var mesocycle = $('#id_mesocycles').val();

	$.ajax({
		url: '/app/ajax/load-lifts/',
		data:{
			'mesocycle': mesocycle
		},
		success: function(data){
			console.log(data)
			$("#id_lifts").html(data);
		}
	});

});

$("#id_lifts").change(function(){
	var lift = $('#id_lifts').val()
	var athlete = $('#id_athlete').val()
	var meso = $("#id_mesocycles").val()
	$.ajax({
		url: '/app/ajax/testpost/',
		data:{
			'athlete': athlete,
			'lift': lift,
			'meso': meso,
		},
		success: function(data){
			myLineChart.data.datasets[0].data = data.default;
  			myLineChart.data.labels = data.labels;
  			myLineChart.data.datasets[0].label = data.name;
  			myLineChart.update();
		}
	});

});


{% endblock %}
</script>

{% block content %}

<div class="isResizable">
  <div class="chart-container">
		<h1>Hello</h1>
		<canvas id="myChart" width="400" height="400"></canvas>
	</div>
</div>
<div class = "container">
	{{request.user.coach.coach.all}}
	<form id = "analyticsForm" action="{% url 'app:test' %}" method="post" all-lifts-url="{% url 'app:ajax_load_lifts' %}">
		{% csrf_token %}
		<div class="control">
  		<div class="select">

		    <select name = "athlete" id="id_athlete">
		      <option>Select dropdown</option>
		      {% for athlete in request.user.coach.coach.all%}
		      	<option>{{athlete.user.username}}</option>
		      {% endfor %}
		    </select>
		  </div>

		<div class="select">

		    <select name = "mesocycles" id="id_mesocycles">
		      <option>Select dropdown</option>
		    </select>
		  </div>
		</div>

		<div class="select">

		    <select name = "lifts" id="id_lifts">
		      <option>Select dropdown</option>
		    </select>
		  </div>
		</div>
		<!--select microcycle-->
		  <button class = 'button is-small is-link' type="submit">
            <i class="fas fa-divide" type="submit"></i>
           </button>
      </form>
</div>


{% endblock content %}